---
title: "Regression discontinuity design (RDD)"
description: |
  A new article created using the Distill format.
author:
  - name: Nora Jones 
    url: https://example.com/norajones
    affiliation: Spacely Sprockets
    affiliation_url: https://example.com/spacelysprokets
date: "`r Sys.Date()`"
output: distill::distill_article
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r}
library(rddtools)
library(foreign)
library(tidyverse)

data(house)

house %>% glimpse()
```



```{r}
house_rdd <- rdd_data(
  x = x, 
  y = y,
  data = house,
  cutpoint = 0
)

house_rdd %>% glimpse()
```

## Exercises

### Opg 1)
>Suppose we’re interested in the effects of the generosity of public assistance on labor supply. Historically, U.S. states have offered widely-varying wel- fare payments to poor unmarried mothers. Labor economists have long been interested in the effects of such income maintenance policies - how much of an increase in living standards they facilitate, and whether they make work less attractive. Could there be any potential problems us- ing a DiD approach to look at this question? (Hint: people can move...) How about the example we covered in class looking at the employment of teenagers?

* Hvis en stat indføre bedre vilkår så vil de måske flytte også vil vi violate 
antagelse om paralelle trend. 

### Opg 2)
> Use the data in ’eitc.dta’ for this question (you’ll have to use the function read.dta(), in the ’foreign’ library, to get it into R). The Earned Income Tax Credit (EITC) is a refundable tax credit for low income working in- dividuals, particularly those with children. A major change to the EITC occurred in 1993. In his first State of the Union Address, President Clinton said, “The new direction I propose will make this solemn, simple commit- ment: By expanding the refundable earned income tax credit, we will make history; we will reward the work of millions of working poor Amer- icans by realizing the principle that if you work forty hours a week and you’ve got a child in the house, you will no longer be in poverty.” The main result of this change was that single, working, women with children get more money from the government. The dataset contains information on single US women around the time of the expansion of EITC.

```{r}
eitc <- 
  foreign::read.dta(file = "data/eitc.dta")

eitc %>% glimpse()
```


#### i)

> Create a dummy variable to indicate post-treatment (assume that 1993 counts as pre-treatment). Also create a dummy variable to indi- cate whether a woman was ’treated’.



```{r}
library(ggplot2)
eitc %>% 
  group_by(fct = as.factor(year)) %>% 
  count(work)  %>% 
  ggplot() +
  geom_col(aes(x = fct, y = n, fill = as.character(work)),
           position = "dodge") + 
  theme_minimal()
```

```{r}
eitc %>% 
  filter(year <= 1993) %>% 
  group_by(fct = as.character(year)) %>% 
  summarise(
    across(where(is.numeric), ~mean(.x, na.rm = TRUE) )
  )
```
```{r}
eitc %>% 
  filter(year > 1993) %>% 
  group_by(fct = as.character(year)) %>% 
  summarise(
    across(where(is.numeric), ~mean(.x, na.rm = TRUE) )
  )
```



```{r}
df <- 
  eitc %>% 
  mutate(time = ifelse(year > 1993, 1, 0 ),
         treated = ifelse(work == 1 & children > 0, 1, 0 ))

df %>% glimpse()
```

#### ii)

> Compute the four averages that you need in order to calculate the DiD estimate of whether the expansion of EITC has lead single mothers to work more. What is the estimate, how do you interpret it, and is this what you expected? Can you say anything about its statistical significance at this point?

```{r}
# differences <- 
#   df %>%
#   group_by(year, trat_dummy) %>%
#   summarise(trat_dummy = mean(work, na.rm = TRUE))
# 
# # Treatment group (NJ) before treatment
# njfeb <- differences[1,3]
# 
# # Control group (PA) before treatment
# pafeb <- differences[2,3]
# 
# # Treatment group (NJ) after treatment
# njnov <- differences[3,3]
# 
# # Control group (PA) after treatment
# panov <- differences[4,3]
```



#### iii)

> Answer the same question as part (ii) but this time, use a regres- sion approach. Has this given you any more information?

```{r}
options(scipen = 666)
did <- lm(work ~ time + treated + time:treated, data = df)

summary(did)
```



#### iv) Include the following controls into your regression from part (iii): nonwhite, age, ed (where ed denotes education). What do you notice? What do you conclude about the causal interpretation from part (iii)?

#### v) 

> Finally, to the regression in part (iv), add unearned income to your regression, unearn (this is income that you get from anything other than working). Now what happens? Why?

