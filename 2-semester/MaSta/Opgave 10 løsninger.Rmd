---
title: "Opgave 10"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```


## webbog opgave 4.1

![](4.1.png)

### a) ensider variansanalyse

Indlæs  data,  og  dan  de  to  variableOmraadeogkornstrmed  indholdet  af  de  to  søj-ler.  Undersøg,  omOmraadeer  en  faktor.  Svaret  afhænger  af,  hvilken  version  afRmankører.  HvisOmraadeikke  er  en  faktor,  skal  du  omdanne  den  til  en  faktor  med  funk-tionenfactor.   Lav   en   figur,   hvorkornstrafsættes  modOmraadekodet   som   1   til   3(dette  kan  du  gøre  ved  at  brugeas.numeric(Omraade)).  Prøv  også  at  lave  et  qqplotmed  kommandoenqqnormFlere(kornstr,Omraade)(se  omtalen  afqqnormFlerei  detskjulte  punktBoxplot  og  qqploti  afsnit  4.6)  og  dernæst  et  boxplot  med  kommandoenboxplot(kornstr∼Omraade). Overvej, hvad disse figurer viser om forholdet mellem spred-ningerne i de tre områder og forholdet mellem middelværdierne.

```{r}
data_a <- read.csv("MatStat-R/data/JLJfiler/Sandproever.csv")
data_a %>% head()
```

```{r}
område <- data_a[,1]
class(område)
område <- as.factor(område)
class(område)
kornstr <- data_a[,2]
```

```{r}
plot(as.numeric(område), kornstr)
```

level 1 og 2 har nogenlunde samme værider.

```{r}
source("MatStat-R/source/Rfunktioner.R")
qqnormFlere(kornstr, område)
```

checker om de følger normal fordeling hvilket de gør. 

```{r}
boxplot(kornstr ~ område)
```

hvordan er middelværdier i 1 og 2 er de meget ens men ikke ofr den 3 gruppe. spredning er større for gruppe 2 end for 1 og 3.  



### b)

Opskriv den statistiske model, hvor data er delt ind i tre grupper svarende til de tre områder,og data er normalfordelt med en middelværdi og varians, der afhænger af gruppen.
Opskriv hypotesen, at de tre varianser er ens. Lav Bartletts test, for at de tre varianser er ens.Hvad bliver konklusionen af testet?

$$
M_1 : kornstr \sim N(\mu_{område}, \sigma^2_{område}) ,\ (\mu_1,\mu_2,\mu_3,\sigma_1^2,\sigma^2_2,\sigma^2_3)\in R^3 x R^3
$$

Hypotese

$$
H0:\sigma^1_1=\sigma^2_2=\sigma^2_3
$$
Laver Bartletts tese

```{r}
bartlett.test(kornstr, område)
```

P værdien er 0.059 og over 0.05 således data ikke strider mod de har samme varians.

### c) 

Opskriv den statistiske model, hvor middelværdien afhænger af området, men de tre vari-anser er ens. Find estimater i denne model (både for middelværdierne og for spredningen).Benyt parametertabellen til at lave ett-test for hypotesen, atμPinaNorth=μPinaSouth.Angiv et 95%-konfidensinterval forμSanLuis−μPinaNorth

$$
M_1: kornstr\sim N(\mu_i,\sigma^2), \ (\mu_1,..,\mu_3,\sigma^2)
$$

```{r}
summary(lm(kornstr ~ område - 1)) #parameter tabel
```
-1 så man ikke får differencer

```{r}
summary(lm(kornstr ~ område - 1))$sigma^2
```

bruge parameter tabellen til lave en t test og se på

```{r}
summary(lm(kornstr ~ område))
```

ser at de to områders middelværdi er ens da pv æride er 0.67 så  data stride rikke mode PinaNorth = PinaSourth

```{r}
confint(lm(kornstr ~ område))
```

den er områdeSanLuis   -0.6397881 -0.44689049

### d)

Opskriv hypotesen, at de tre middelværdier er ens, og lav et test for denne hypotese ved etpassende kald tilanova.Hvad bliver konklusionen i denne opgave: er det rimeligt at sige, at der er samme middel-værdi af middelkornstørrelsen i de tre områder af Altar ørkenen 

$$
M_1: kornstr\sim N(\mu_i,\sigma^2), \ (\mu,\sigma^2)
$$

Hypotesen

$$
\mu_1 =\mu_2=\mu_3
$$

anova

```{r}
anova(lm(kornstr ~ område))
```

lav p værdi så den strider mod H0 dermed er de tre middelværdier ikke ens. 

Det er også hvad vi så i vores boxplot.

## webbog opgave 4.2 - to sidet varians

I  artiklen  Environmental  heterogeneity  does  not  affect  levels  of  phenotypic  plasticity  in  natu-ral  populations  of  three  Drosophila  species  undersøges,  hvordan  forskellige  arter  og  geografiskadskilte grupper af bananfluer reagerer på miljøpåvirkninger. I denne opgave skal I se på en del-mængde af data, hvor der betragtes D.melanogasterindsamlet i henholdsvis Danmark og Italien.Fra ægstadiet og frem udsættes fluerne for tre forskellige behandlinger: C (constant), PF (predi-ctable fluctuation) og UF (unpredictalbe fluctuation). For C-gruppen holdes temperaturen kon-stant på 23 (grader celsius) hen over døgnet, for PF følger temperaturen en sinuskurve med mak-simum på 18 og minimum på 13, og for UF følger temperaturen også en sinuskurve, men medstokastiske maksimum og minimum for hvert døgn. Ved en given alder udsættes fluerne for enkritisk varmepåvirkning (37.5 grader celsius uafbrudt), og tiden (minutter) indtil fluen går i komaregistreres. Med undersøgelsen ønsker man således at se, om forskel i opvæksten har betydningfor deres evne til at klare varmepåvirkningen, og om der er forskel i de to geografiske populatio-ner med hensyn til denne evne. Gennemsnit og empirisk spredning for logaritmen til tiden indtilkoma er gengivet for hver kombination af land og behandling i nedenstående tabel.

Data i artiklen kan findes underDryad Digital Repository. Data til opgaven her er i filenBanan-fluer.csv, hvor søjle 1 angiver land, søjle 2 angiver behandling og søjle 3 angiver tiden i minutter,indtil fluen går i koma.

```{r}
data_b <- read.csv("MatStat-R/data/JLJfiler/Bananfluer.csv")
data_b %>% head()
```


### a)   additivit plot

Du skal først se på, om tidsmålingerne kan beskrives med en normalfordeling, eller om manførst bør tage logaritmen til tidsmålingerne. Indlæs data og dan variableneLand,Behand-lingogtid. HvisLandogBehandlingikke er faktorer efter indlæsningen, skal du omdan-ne dem til faktorer. Lav qqplots fortidfor alle seks kombinationer af land og behandlingmed  kommandoenqqnormFlere(tid,Land:Behandling)(se  omtalen  afqqnormFlereidet  skjulte  punktBoxplot  og  qqploti  afsnit  4.6).  Lav  dernæst  tilsvarende  qqplot  for  loga-ritmen tiltid.Hvad bliver din konklusion ud fra de to figurer ?

Lav dernæst interaktionsplot for logaritmen til tiden i forhold til de to faktorer land og be-handling  (se  omtalen  af  funktionenadditivitetsPloti  det  skjulte  punktInteraktionsplotiafsnit 4.6).


```{r}
land <- as.factor(data_b$Land)
behandlign <- as.factor(data_b$Behandling)
tid <- log(data_b$Tid)

qqnormFlere(tid, land:behandlign)

```

mere normal når vi bruger log. 

```{r}
par(mfrow = c(1,2))
additivitetsPlot(land, behandlign, tid)
additivitetsPlot(behandlign, land, tid)
```

Her ser vi de tre behandlinger,  venstre side er er de danske fluer mens højre er de italienske. stregen forbinder puntkerne. den anden plot er vi kan e de forskellige behandling. italien har laver levetid ved alle behandlinger.. Dem med den konstante behandling har lavere levetid. 

### b)  

Opskriv modellen, hvor logaritmen til tidsmålingen hørende til hver gruppe bestemt af landog behandling følger sin egen normalfordeling.Opskriv hypotesen, at varianserne i de 6 grupper er ens, og lav Bartletts test for denne hy-potese. Er det rimeligt at sige, at de seks varianser er ens ?

$$
logtid_i \sim N(\mu_{L_i,B_i}, {\sigma^2_{L_i,B_i}})
$$

```{r}
bartlett.test(tid ~ land)
```

```{r}
bartlett.test(tid ~ behandlign)
```

Vi laver en barlet test for tid på land og behandling. 



### c)  ens varians

Opskriv  modellen,  hvor  logaritmen  til  tiden  er  normalfordelt,  og  hver  gruppe  bestemt  afland og behandling har sin egen middelværdi, og alle har den samme varians. Opskriv indenfor denne model additivitetshypotesen, hvor middelværdien består af et bidrag fra land oget bidrag fra behandling.Lav et test, for at data kan beskrives med den additive model. Hvad bliver konklusionen aftestet ?  Stemmer konklusionen, med hvad du kan se i interaktionsplottet ?

$$
logtid_i \sim N(\mu_{L_i,B_i}, {\sigma^2})
$$

```{r}
m2 <- lm(tid~ land + behandlign)
summary(m2)
```

Siden vi går ud fra de har ens varians så bruger vi t testen

```{r}
m1tilm2 <- anova(lm(tid ~ land + behandlign), lm(tid ~ land:behandlign))
m1tilm2
```

høj p værdi så vi kan bruge den additive model. 

### d)  

Lav et test for henholdsvis ingen effekt af behandling og ingen effekt af land inden for denadditive model.

```{r}
m2tilm3behandling <- anova(lm(tid ~ land), lm(tid ~ land + behandlign))
m2tilm3land <- anova(lm(tid ~ behandlign), lm(tid ~ land + behandlign))
m2tilm3behandling
m2tilm3land
```

Vi kan ikke forkadte h0 så de har betydnign. 

### e)  

Angiv inden for den addititve model et 95%-konfidensinterval for forskellen i middelværdiaf logaritmen til tiden mellem de to lande.Oversæt det fundne interval til et interval for forholdet mellem middelværdierne af tid indtilkoma for de to lande, jævnfør underafsnit 2.13.3.


## webbog opgave 4.5

![](4.5.png)

## webbog opgave 4.6

![](4.6.png)
### a)

```{r}
anova(lm(kornstr ~ 1), lm(kornstr ~ område)) # rigtig 75

model_sum_1 <- summary(lm(kornstr ~ 1))
model_sum_2 <- summary(lm(kornstr ~ område))
ssd2 <- model_sum_1$sigma^2*model_sum_1$df[2]
ssd1 <- model_sum_2$sigma^2*model_sum_2$df[2]

((ssd2 - ssd1) /
  (model_sum_1$df[2] - model_sum_2$df[2])) /
  (ssd1 / 35)
```

 

### b) fitted values

```{r}
# find
((ssd2 - ssd1) /
  (model_sum_1$df[2] - model_sum_2$df[2]))
```

Fra de fittede værdie

```{r}
sum((lm(kornstr ~ område)$fitted.values -
      lm(kornstr ~ 1)$fitted.values)^2) / 
  (model_sum_1$df[2] - model_sum_2$df[2])
```




## webbog opgave 4.8

Gå tilbage til spørgsmål (e) i opgave 4.2, hvor der findes et konfidensinterval for forskellen i mid-delværdi af logaritmen til tiden mellem de to lande. Beregn dette interval baseret på den infor-mation du får fra et passende kald tilsummary(lm(modelformel)).


$$
(\bar X - \bar Y)+- q \sqrt{\frac{S_1^2}{n_1} + \frac{S_2^2}{n_2}}
$$

```{r}
lmUD <- lm(tid ~ land + behandlign)
sumUD <- summary(lmUD)
sumUD
diff_mean <- lmUD$coefficients["landIT"]

q <- qt(0.975, 116)
S_1 <- sumUD$sigma
n <- 60
diff_mean - q * (sqrt((S_1^2/n)+(S_1^2/n)))
confint(lmUD)
```

